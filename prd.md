Of course. Here is a comprehensive write-up designed to be fed directly into a code-generating AI like Cursor. It provides the necessary context, technical specifications, and a detailed API reference to build the MVP.

---

### MVP Development Brief: Cyperf-CE Web UI and REST API Controller

This document outlines the requirements for an MVP web application that provides a user-friendly UI and a RESTful API to control the Keysight Cyperf CE command-line tool.

#### 1. Context for the Solution

**The Problem:** Keysight Cyperf CE is a powerful, free network performance testing tool. However, its usage is limited to the command line, requiring manual execution and making it difficult to integrate into automated workflows or for users who are not comfortable with CLIs.

**The Solution:** We will build a single, self-contained web application, the **"Cyperf Controller,"** that acts as a centralized control plane for running `cyperf-ce` tests. This application will serve two primary purposes:

1.  **A REST API:** To allow for programmatic control and automation of Cyperf tests (e.g., from CI/CD pipelines or other scripts).
2.  **A Web UI:** A simple, browser-based interface for users to easily configure, run, monitor, and stop tests without touching the command line.

The Controller will be responsible for launching `cyperf-ce` client and server processes as local subprocesses, managing their state, and exposing their output.

#### 2. Technical Stack Details

The entire application will be served from a single backend service to simplify deployment and networking.

##### **Backend**

*   **Framework:** **FastAPI** (Python)
*   **Responsibilities:**
    1.  **Expose the REST API:** Define and serve the API endpoints detailed below.
    2.  **Process Management:** Use Python's `subprocess` module to start and stop `cyperf-ce` processes in the background. It must have the necessary `sudo` permissions to run the `cyperf` command.
    3.  **State Management:** Maintain the state of all active tests. For the MVP, a simple in-memory Python dictionary is sufficient. The key will be a unique `test_id` (a UUID), and the value will be a dictionary containing the server/client PIDs and paths to their log/result files.
        ```python
        # Example internal state dictionary
        {
          "a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c": {
            "server_pid": 12345,
            "server_log_path": "/tmp/cyperf/a9e6b8c0_server.log",
            "server_csv_path": "/tmp/cyperf/a9e6b8c0_server.csv",
            "client_pid": 54321,
            "client_log_path": "/tmp/cyperf/a9e6b8c0_client.log",
            "client_csv_path": "/tmp/cyperf/a9e6b8c0_client.csv"
          }
        }
        ```
    4.  **Serve the Frontend:** The compiled static React application will be served directly by FastAPI from the root URL (`/`). This ensures the entire application runs on a single IP and port.
        ```python
        from fastapi.staticfiles import StaticFiles

        # This will be in the main FastAPI application file
        app.mount("/", StaticFiles(directory="static", html=True), name="static")
        ```
    5.  **API Documentation:** The interactive Swagger UI documentation, automatically generated by FastAPI, will be available at the `/docs` endpoint.

##### **Frontend**

*   **Framework:** **React** (using Vite for project setup)
*   **Responsibilities:**
    1.  **Single Page Application (SPA):** Provide the entire user experience in the browser without page reloads.
    2.  **User Interface:**
        *   A configuration form to input all `cyperf` parameters for both server and client.
        *   Buttons to "Start Test" and "Stop Test".
        *   A display area to show the active `test_id` and process PIDs.
        *   Two text areas to display the logs/stats for the server and client.
    3.  **Live Stats (Polling):** The UI will achieve a "live" feel by polling the backend. After a test is started, the frontend will use `setInterval` to call the `GET /server/stats/{test_id}` and `GET /client/stats/{test_id}` endpoints every 2-3 seconds. The returned log content will be displayed in the text areas. The polling will be stopped when the user clicks "Stop Test".

#### 3. Simple API: Endpoint Reference

The following table details the procedural REST API to be implemented by the FastAPI backend.

| Operation | API Call | Description | Sample Request | Sample Response |
| :--- | :--- | :--- | :--- | :--- |
| **1. SETUP AND RUN SERVER** | **`POST /server`** | Starts the `cyperf -s` server process. Generates a unique **`test_id`** that must be used for all subsequent operations related to this test. | **Payload:**<br>```json<br>{<br>  "params": {<br>    "cps": true,<br>    "port": 5202,<br>    "length": "1k",<br>    "csv_stats": true<br>  }<br>}<br>``` | **Status:** `201 Created` <br><br> **Body:**<br>```json<br>{<br>  "test_id": "a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c",<br>  "server_pid": 12345,<br>  "status": "SERVER_RUNNING",<br>  "message": "Cyperf server started. Use test_id for all related operations."<br>}<br>``` |
| **2. SETUP AND RUN CLIENT** | **`POST /client`** | Starts the `cyperf -c` client process, linking it to an existing server using the **`test_id`**. The request must include the server's IP address. | **Payload:**<br>```json<br>{<br>  "test_id": "a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c",<br>  "server_ip": "192.168.1.100",<br>  "params": {<br>    "cps": "10k/s",<br>    "port": 5202,<br>    "length": "1k",<br>    "time": 60,<br>    "csv_stats": true<br>  }<br>}<br>``` | **Status:** `200 OK` <br><br> **Body:**<br>```json<br>{<br>  "test_id": "a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c",<br>  "client_pid": 54321,<br>  "status": "CLIENT_RUNNING",<br>  "message": "Cyperf client started and linked to server."<br>}<br>``` |
| **3. CLEANUP AND STOP** | **`DELETE /test/{test_id}`** | Stops both the client and server processes associated with the given **`test_id`** using a graceful signal. | **Action:** No request body needed. `test_id` is in the URL.<br><br>`DELETE /test/a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c` | **Status:** `200 OK` <br><br> **Body:**<br>```json<br>{<br>  "test_id": "a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c",<br>  "status": "STOPPED",<br>  "message": "Stop signal sent to server (PID: 12345) and client (PID: 54321)."<br>}<br>``` |
| **4. GET SERVER STATS** | **`GET /server/stats/{test_id}`** | Retrieves the live log output (which includes statistics) for the server process associated with the given **`test_id`**. | **Action:** No request body needed. `test_id` is in the URL.<br><br>`GET /server/stats/a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c` | **Status:** `200 OK`<br>**Content-Type:** `text/plain`<br><br>**Body:** The raw `stdout` from the server process.<br>```text<br>[ ID] Interval       Transfer     Bitrate<br>[  5]   0.00-3.00   sec  44.7 MBytes   125 Mbits/sec<br>``` |
| **5. GET CLIENT STATS** | **`GET /client/stats/{test_id}`** | Retrieves the live log output for the client process associated with the given **`test_id`**. | **Action:** No request body needed. `test_id` is in the URL.<br><br>`GET /client/stats/a9e6b8c0-d3f2-4e1a-8c9b-1d0f2e3a4b5c` | **Status:** `200 OK`<br>**Content-Type:** `text/plain`<br><br>**Body:** The raw `stdout` from the client process.<br>```text<br>[ ID] Interval       Transfer     Bitrate<br>[  5]   0.00-3.00   sec  44.7 MBytes   125 Mbits/sec<br>``` |